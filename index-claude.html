<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neo4j Graph Viz & LLM Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/neovis.js@2.1.0"></script>
    <style>
        #viz {
            width: 100%;
            height: 100%;
            border-radius: 0.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .chat-message {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .graph-controls button:hover {
            transform: scale(1.05);
            transition: transform 0.2s;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="app">
        <div class="h-screen flex flex-col">
            <!-- Header -->
            <header class="bg-gray-800 shadow-lg border-b border-gray-700">
                <div class="px-6 py-4">
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-transparent">
                        Neo4j Knowledge Graph & AI Assistant
                    </h1>
                </div>
            </header>

            <!-- Main Content -->
            <div class="flex-1 flex overflow-hidden">
                <!-- Graph Visualization Panel -->
                <div class="w-1/2 p-4 border-r border-gray-700">
                    <div class="h-full flex flex-col bg-gray-800 rounded-lg shadow-xl">
                        <!-- Graph Controls -->
                        <div class="p-4 border-b border-gray-700">
                            <h2 class="text-lg font-semibold mb-3">Knowledge Graph</h2>
                            <div class="graph-controls flex gap-2 flex-wrap">
                                <button @click="resetGraph" 
                                    class="px-3 py-1 bg-purple-600 hover:bg-purple-700 rounded text-sm transition-colors">
                                    Reset View
                                </button>
                                <button @click="loadSampleData('ontology1')" 
                                    class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm transition-colors">
                                    Ontology 1
                                </button>
                                <button @click="loadSampleData('ontology2')" 
                                    class="px-3 py-1 bg-green-600 hover:bg-green-700 rounded text-sm transition-colors">
                                    Ontology 2
                                </button>
                                <button @click="togglePhysics" 
                                    class="px-3 py-1 bg-yellow-600 hover:bg-yellow-700 rounded text-sm transition-colors">
                                    {{ physicsEnabled ? 'Disable' : 'Enable' }} Physics
                                </button>
                            </div>
                        </div>
                        
                        <!-- Graph Container -->
                        <div class="flex-1 p-4 relative">
                            <div id="viz"></div>
                            <div v-if="loading" class="absolute inset-0 flex items-center justify-center bg-gray-800 bg-opacity-75 rounded">
                                <div class="text-center">
                                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto"></div>
                                    <p class="mt-2 text-sm text-gray-400">Loading graph...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Graph Info -->
                        <div class="p-4 border-t border-gray-700 text-sm">
                            <div class="flex justify-between text-gray-400">
                                <span>Nodes: {{ graphStats.nodes }}</span>
                                <span>Edges: {{ graphStats.edges }}</span>
                                <span>{{ selectedNode ? `Selected: ${selectedNode}` : 'Click a node for details' }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Panel -->
                <div class="w-1/2 p-4">
                    <div class="h-full flex flex-col bg-gray-800 rounded-lg shadow-xl">
                        <!-- Chat Header -->
                        <div class="p-4 border-b border-gray-700">
                            <h2 class="text-lg font-semibold">AI Assistant</h2>
                            <p class="text-sm text-gray-400">Ask questions about the knowledge graph</p>
                        </div>

                        <!-- Chat Messages -->
                        <div ref="chatContainer" class="flex-1 overflow-y-auto p-4 space-y-4">
                            <div v-if="messages.length === 0" class="text-center text-gray-500 mt-8">
                                <svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                        d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z">
                                    </path>
                                </svg>
                                <p>Start a conversation about the knowledge graph</p>
                                <div class="mt-4 space-y-2">
                                    <button @click="sendQuickMessage('What entities are in the graph?')" 
                                        class="text-purple-400 hover:text-purple-300 text-sm">
                                        "What entities are in the graph?"
                                    </button>
                                    <br>
                                    <button @click="sendQuickMessage('Explain the relationships')" 
                                        class="text-purple-400 hover:text-purple-300 text-sm">
                                        "Explain the relationships"
                                    </button>
                                </div>
                            </div>

                            <div v-for="(message, index) in messages" :key="index" 
                                class="chat-message flex" 
                                :class="message.role === 'user' ? 'justify-end' : 'justify-start'">
                                <div class="max-w-xs lg:max-w-md px-4 py-2 rounded-lg"
                                    :class="message.role === 'user' 
                                        ? 'bg-purple-600 text-white' 
                                        : 'bg-gray-700 text-gray-100'">
                                    <div class="text-sm font-semibold mb-1"
                                        :class="message.role === 'user' ? 'text-purple-200' : 'text-gray-400'">
                                        {{ message.role === 'user' ? 'You' : 'AI Assistant' }}
                                    </div>
                                    <div class="text-sm whitespace-pre-wrap">{{ message.content }}</div>
                                    <div class="text-xs mt-1"
                                        :class="message.role === 'user' ? 'text-purple-300' : 'text-gray-500'">
                                        {{ message.timestamp }}
                                    </div>
                                </div>
                            </div>

                            <div v-if="isTyping" class="flex justify-start">
                                <div class="bg-gray-700 rounded-lg px-4 py-2">
                                    <div class="flex space-x-2">
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Input -->
                        <div class="p-4 border-t border-gray-700">
                            <form @submit.prevent="sendMessage" class="flex gap-2">
                                <input 
                                    v-model="inputMessage"
                                    type="text"
                                    placeholder="Ask about the knowledge graph..."
                                    class="flex-1 px-4 py-2 bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-white placeholder-gray-400"
                                    :disabled="isTyping">
                                <button 
                                    type="submit"
                                    :disabled="!inputMessage.trim() || isTyping"
                                    class="px-6 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                            d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8">
                                        </path>
                                    </svg>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, nextTick, watch } = Vue;

        createApp({
            setup() {
                // State
                const loading = ref(false);
                const physicsEnabled = ref(true);
                const selectedNode = ref(null);
                const graphStats = ref({ nodes: 0, edges: 0 });
                const messages = ref([]);
                const inputMessage = ref('');
                const isTyping = ref(false);
                const chatContainer = ref(null);
                let viz = null;

                // Mock Data Generation
                const generateMockData = (type) => {
                    const data = {
                        ontology1: {
                            nodes: [
                                { id: 1, label: "Person", group: "entity", title: "Entity: Person" },
                                { id: 2, label: "Organization", group: "entity", title: "Entity: Organization" },
                                { id: 3, label: "Product", group: "entity", title: "Entity: Product" },
                                { id: 4, label: "Location", group: "entity", title: "Entity: Location" },
                                { id: 5, label: "Event", group: "entity", title: "Entity: Event" },
                                { id: 6, label: "John Doe", group: "instance", title: "Person: John Doe" },
                                { id: 7, label: "TechCorp", group: "instance", title: "Organization: TechCorp" },
                                { id: 8, label: "AI Platform", group: "instance", title: "Product: AI Platform" },
                                { id: 9, label: "Seoul", group: "instance", title: "Location: Seoul" },
                                { id: 10, label: "Conference 2024", group: "instance", title: "Event: Conference 2024" }
                            ],
                            edges: [
                                { from: 6, to: 1, label: "instanceOf", arrows: "to" },
                                { from: 7, to: 2, label: "instanceOf", arrows: "to" },
                                { from: 8, to: 3, label: "instanceOf", arrows: "to" },
                                { from: 9, to: 4, label: "instanceOf", arrows: "to" },
                                { from: 10, to: 5, label: "instanceOf", arrows: "to" },
                                { from: 6, to: 7, label: "worksAt", arrows: "to" },
                                { from: 7, to: 8, label: "develops", arrows: "to" },
                                { from: 7, to: 9, label: "locatedIn", arrows: "to" },
                                { from: 10, to: 9, label: "heldIn", arrows: "to" },
                                { from: 6, to: 10, label: "attends", arrows: "to" }
                            ]
                        },
                        ontology2: {
                            nodes: [
                                { id: 1, label: "Concept", group: "meta", title: "Meta: Concept" },
                                { id: 2, label: "Technology", group: "concept", title: "Concept: Technology" },
                                { id: 3, label: "Science", group: "concept", title: "Concept: Science" },
                                { id: 4, label: "AI", group: "technology", title: "Technology: AI" },
                                { id: 5, label: "Blockchain", group: "technology", title: "Technology: Blockchain" },
                                { id: 6, label: "MachineLearning", group: "technology", title: "Technology: ML" },
                                { id: 7, label: "Physics", group: "science", title: "Science: Physics" },
                                { id: 8, label: "Biology", group: "science", title: "Science: Biology" },
                                { id: 9, label: "DeepLearning", group: "technology", title: "Technology: Deep Learning" },
                                { id: 10, label: "QuantumComputing", group: "technology", title: "Technology: Quantum Computing" }
                            ],
                            edges: [
                                { from: 2, to: 1, label: "subClassOf", arrows: "to" },
                                { from: 3, to: 1, label: "subClassOf", arrows: "to" },
                                { from: 4, to: 2, label: "belongsTo", arrows: "to" },
                                { from: 5, to: 2, label: "belongsTo", arrows: "to" },
                                { from: 6, to: 2, label: "belongsTo", arrows: "to" },
                                { from: 7, to: 3, label: "branchOf", arrows: "to" },
                                { from: 8, to: 3, label: "branchOf", arrows: "to" },
                                { from: 9, to: 6, label: "subFieldOf", arrows: "to" },
                                { from: 9, to: 4, label: "partOf", arrows: "to" },
                                { from: 10, to: 7, label: "relatedTo", arrows: "to" },
                                { from: 10, to: 2, label: "belongsTo", arrows: "to" },
                                { from: 4, to: 6, label: "uses", arrows: "to" }
                            ]
                        }
                    };
                    return data[type] || data.ontology1;
                };

                // NeoVis Configuration
                const createNeoVisConfig = (data) => {
                    return {
                        containerId: "viz",
                        neo4j: {
                            serverUrl: "bolt://localhost:7687",
                            serverUser: "neo4j",
                            serverPassword: "password"
                        },
                        visConfig: {
                            nodes: {
                                shape: 'dot',
                                size: 25,
                                font: {
                                    size: 14,
                                    color: '#ffffff'
                                },
                                borderWidth: 2,
                                shadow: true
                            },
                            edges: {
                                arrows: {
                                    to: { enabled: true, scaleFactor: 1 }
                                },
                                color: { color: '#848484' },
                                font: {
                                    size: 12,
                                    color: '#ffffff',
                                    align: 'middle'
                                },
                                smooth: {
                                    type: 'curvedCW',
                                    roundness: 0.2
                                }
                            },
                            groups: {
                                entity: {
                                    color: { background: '#9333ea', border: '#7c3aed' }
                                },
                                instance: {
                                    color: { background: '#3b82f6', border: '#2563eb' }
                                },
                                meta: {
                                    color: { background: '#ef4444', border: '#dc2626' }
                                },
                                concept: {
                                    color: { background: '#f59e0b', border: '#d97706' }
                                },
                                technology: {
                                    color: { background: '#10b981', border: '#059669' }
                                },
                                science: {
                                    color: { background: '#ec4899', border: '#db2777' }
                                }
                            },
                            physics: {
                                enabled: physicsEnabled.value,
                                stabilization: {
                                    iterations: 100,
                                    fit: true
                                },
                                barnesHut: {
                                    gravitationalConstant: -8000,
                                    springConstant: 0.001,
                                    springLength: 200
                                }
                            },
                            interaction: {
                                hover: true,
                                tooltipDelay: 200,
                                zoomView: true,
                                dragView: true
                            },
                            layout: {
                                improvedLayout: true,
                                randomSeed: 42
                            }
                        },
                        data: data,
                        displayData: true
                    };
                };

                // Graph Methods
                const initializeGraph = (type = 'ontology1') => {
                    loading.value = true;
                    const mockData = generateMockData(type);
                    graphStats.value = {
                        nodes: mockData.nodes.length,
                        edges: mockData.edges.length
                    };

                    setTimeout(() => {
                        if (viz) {
                            viz.reload(mockData);
                        } else {
                            const config = createNeoVisConfig(mockData);
                            viz = new NeoVis(config);
                            viz.render();
                            
                            viz.network.on('click', (params) => {
                                if (params.nodes.length > 0) {
                                    const nodeId = params.nodes[0];
                                    const node = mockData.nodes.find(n => n.id === nodeId);
                                    selectedNode.value = node ? node.label : null;
                                }
                            });
                        }
                        loading.value = false;
                    }, 500);
                };

                const loadSampleData = (type) => {
                    initializeGraph(type);
                };

                const resetGraph = () => {
                    if (viz && viz.network) {
                        viz.network.fit();
                    }
                };

                const togglePhysics = () => {
                    physicsEnabled.value = !physicsEnabled.value;
                    if (viz && viz.network) {
                        viz.network.setOptions({
                            physics: { enabled: physicsEnabled.value }
                        });
                    }
                };

                // Chat Methods
                const sendMessage = async () => {
                    const message = inputMessage.value.trim();
                    if (!message) return;

                    messages.value.push({
                        role: 'user',
                        content: message,
                        timestamp: new Date().toLocaleTimeString()
                    });

                    inputMessage.value = '';
                    isTyping.value = true;

                    await nextTick();
                    scrollToBottom();

                    // Simulate AI response
                    setTimeout(() => {
                        const aiResponse = generateAIResponse(message);
                        messages.value.push({
                            role: 'assistant',
                            content: aiResponse,
                            timestamp: new Date().toLocaleTimeString()
                        });
                        isTyping.value = false;
                        
                        nextTick(() => {
                            scrollToBottom();
                        });
                    }, 1000 + Math.random() * 1000);
                };

                const sendQuickMessage = (message) => {
                    inputMessage.value = message;
                    sendMessage();
                };

                const generateAIResponse = (userMessage) => {
                    const responses = {
                        default: "I can help you understand the knowledge graph structure. The current graph shows various entities and their relationships. Would you like me to explain specific nodes or relationships?",
                        entities: `The graph contains ${graphStats.value.nodes} nodes representing different entities and concepts. These include both abstract entities (like Person, Organization) and concrete instances (like specific people and companies). Each node is color-coded by its type.`,
                        relationships: "The relationships in this graph include:\n• instanceOf: Links instances to their entity types\n• worksAt: Employment relationships\n• develops: Creation/development relationships\n• locatedIn: Geographic relationships\n• subClassOf: Hierarchical classification\n\nThese relationships help model real-world connections between entities.",
                        selected: `You've selected "${selectedNode.value}". This node represents an important entity in our knowledge graph. It's connected to other nodes through various relationships that define its role in the system.`
                    };

                    const lowerMessage = userMessage.toLowerCase();
                    
                    if (lowerMessage.includes('entit') || lowerMessage.includes('node')) {
                        return responses.entities;
                    } else if (lowerMessage.includes('relation') || lowerMessage.includes('edge')) {
                        return responses.relationships;
                    } else if (selectedNode.value && lowerMessage.includes('select')) {
                        return responses.selected;
                    }
                    
                    return responses.default;
                };

                const scrollToBottom = () => {
                    if (chatContainer.value) {
                        chatContainer.value.scrollTop = chatContainer.value.scrollHeight;
                    }
                };

                // Lifecycle
                onMounted(() => {
                    initializeGraph();
                });

                return {
                    loading,
                    physicsEnabled,
                    selectedNode,
                    graphStats,
                    messages,
                    inputMessage,
                    isTyping,
                    chatContainer,
                    initializeGraph,
                    loadSampleData,
                    resetGraph,
                    togglePhysics,
                    sendMessage,
                    sendQuickMessage
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
